{% extends 'base.html'%}
{% load static %}
{% load price_filters %}

{% block title %}{{ page_title }}{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'css/core/all_hostels.css' %}" />

<div class="hostels">
  <h1 class="page-title">
    <a href="/"><i class="bx bx-home-alt"></i></a>
    <i class="bx bx-chevron-right"></i>
    {{ page_title }}
  </h1>

  <div class="side-side">
    <!-- Hostels list -->
    <div class="hostel-container">
      {% if hostels %}
        <div class="results-info">
          Showing {{ hostels.start_index }} - {{ hostels.end_index }} of {{ total_results }} hostels
        </div>

        <div class="hostel-cards">
          {% for hostel in hostels %}
            <a 
              href="{% url 'hostel_detail' hostel.slug %}?type={{ hostel_type }}{% if query %}&q={{ query }}{% endif %}" 
              style="text-decoration: none; color: inherit"
            >
              <div class="house-card">
                <div class="house-image-container">
                  <img
                    src="{{ hostel.images.first.image.url }}"
                    alt="{{ hostel.name }}"
                    class="house-image"
                    loading="lazy"
                  />
                </div>

                <div class="house-content">
                  <div class="house-details">
                    <p class="house-price">KSh {{ hostel.pricing|format_price }}</p>
                    <h4 class="house-name">{{ hostel.name }}</h4>
                    <p class="house-location">
                      <i class="bxr bx-location"></i> {{ hostel.location }}
                    </p>
                    <p class="available-units">
                      {{ hostel.available_vacants }} units
                    </p>
                  </div>

                  <div class="contact-icons">
                    <!-- Default to my number if hostel has no phone -->
                      {% with phone_number=hostel.phone|default:"+254703853259" %}
                        <a 
                          href="tel:{{ phone_number }}" 
                          class="phone-link" 
                          onclick="event.stopPropagation();"
                        >
                          <i class="bx bx-phone"></i>
                        </a>
                        <a 
                          href="https://wa.me/{{ phone_number }}" 
                          class="whatsapp-link" 
                          target="_blank" 
                          onclick="event.stopPropagation();"
                        >
                          <i class="bx bxl-whatsapp"></i>
                        </a>
                      {% endwith %}
                    </div>
                </div>
              </div>
            </a>
          {% endfor %}
        </div>

        <!-- Pagination -->
        {% if hostels.has_other_pages %}
          <div class="pagination">
            <!-- Previous button -->
            {% if hostels.has_previous %}
              <a href="?{% if query %}q={{ query }}&{% endif %}{% if hostel_type %}type={{ hostel_type }}&{% endif %}page={{ hostels.previous_page_number }}">
                <i class="bx bx-chevron-left"></i>
              </a>
            {% else %}
              <span class="disabled">
                <i class="bx bx-chevron-left"></i>
              </span>
            {% endif %}

            <!-- Page numbers -->
            {% with current=hostels.number total=hostels.paginator.num_pages %}
              {% if current == 1 %}
                <!-- Show: 1, 2, 3 -->
                <span class="current">1</span>
                {% if total >= 2 %}
                  <a href="?{% if query %}q={{ query }}&{% endif %}{% if hostel_type %}type={{ hostel_type }}&{% endif %}page=2">2</a>
                {% endif %}
                {% if total >= 3 %}
                  <a href="?{% if query %}q={{ query }}&{% endif %}{% if hostel_type %}type={{ hostel_type }}&{% endif %}page=3">3</a>
                {% endif %}

              {% elif current == total %}
                <!-- Show: last-2, last-1, last -->
                {% if total >= 3 %}
                  <a href="?{% if query %}q={{ query }}&{% endif %}{% if hostel_type %}type={{ hostel_type }}&{% endif %}page={{ total|add:'-2' }}">{{ total|add:'-2' }}</a>
                {% endif %}
                {% if total >= 2 %}
                  <a href="?{% if query %}q={{ query }}&{% endif %}{% if hostel_type %}type={{ hostel_type }}&{% endif %}page={{ total|add:'-1' }}">{{ total|add:'-1' }}</a>
                {% endif %}
                <span class="current">{{ total }}</span>

              {% else %}
                <!-- Show: current-1, current, current+1 -->
                <a href="?{% if query %}q={{ query }}&{% endif %}{% if hostel_type %}type={{ hostel_type }}&{% endif %}page={{ current|add:'-1' }}">{{ current|add:'-1' }}</a>
                <span class="current">{{ current }}</span>
                <a href="?{% if query %}q={{ query }}&{% endif %}{% if hostel_type %}type={{ hostel_type }}&{% endif %}page={{ current|add:'1' }}">{{ current|add:'1' }}</a>
              {% endif %}
            {% endwith %}

            <!-- Next button -->
            {% if hostels.has_next %}
              <a href="?{% if query %}q={{ query }}&{% endif %}{% if hostel_type %}type={{ hostel_type }}&{% endif %}page={{ hostels.next_page_number }}">
                <i class="bx bx-chevron-right"></i>
              </a>
            {% else %}
              <span class="disabled">
                <i class="bx bx-chevron-right"></i>
              </span>
            {% endif %}
          </div>
        {% endif %}
      {% else %}
        <div class="no-hostels">
          <p>No hostels found.</p>
        </div>
      {% endif %}
    </div>

    <!-- How it works section -->
    <div class="how-it-works">
      <div class="container">
        <div class="header">
          <h1 class="main-title">How it works</h1>
          <p class="subtitle">
            Thousands of tenants and students are finding houses and hostels through 
            <span class="brand">JoouStay</span>. Hereâ€™s how you can too:
          </p>
        </div>

        <div class="vertical-layout">
          <div class="vertical-step">
            <div class="vertical-icon-wrapper">
              <i class="bx bx-search vertical-icon"></i>
            </div>
            <div class="vertical-content">
              <div class="step-label">Step 1</div>
              <h3 class="step-title">SEARCH A HOUSE OR HOSTEL</h3>
            </div>
            <div class="vertical-connector"></div>
          </div>

          <div class="vertical-step">
            <div class="vertical-icon-wrapper">
              <i class="bx bx-list-check vertical-icon"></i>
            </div>
            <div class="vertical-content">
              <div class="step-label">Step 2</div>
              <h3 class="step-title">REVIEW SUGGESTED OPTIONS</h3>
            </div>
            <div class="vertical-connector"></div>
          </div>

          <div class="vertical-step">
            <div class="vertical-icon-wrapper">
              <i class="bx bxs-phone-call vertical-icon"></i>
            </div>
            <div class="vertical-content">
              <div class="step-label">Step 3</div>
              <h3 class="step-title">CLICK CONTACT LINKS (PHONE OR WHATSAPP)</h3>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
