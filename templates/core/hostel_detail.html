{% extends 'base.html' %} {% load static %} {% load price_filters %} 
{% block title %}{{ hostel.name }} in {{ hostel.location }}{% endblock %} 
{% block content %}
<link rel="stylesheet" href="{% static 'css/core/hostel_details.css' %}" />

<div class="hostels">
  <!-- Breadcrumb / Page title -->
  <h1 class="page-title">
    <a href="/"><i class="bx bx-home-alt"></i></a>
    <i class="bx bx-chevron-right"></i>
    <a
      href="{% url 'all_hostels' %}?type={{ hostel_type }}{% if query %}&q={{ query }}{% endif %}"
      >{{ page_title }}</a
    >
    <i class="bx bx-chevron-right"></i>
    <span class="hostel-name">{{ hostel.name }}</span>
  </h1>

  <!-- Hostel main title and location -->
  <div class="hostel-title-location">
    <h3>{{ hostel.name }} in {{ hostel.location }}</h3>
  </div>

  <div class="side-side">
    <div class="hostel-information">
      <!-- Media gallery: main image/video + thumbnails -->
      <div class="media-gallery">
        <div class="main-media">
          {% if hostel.video %}
          <video id="mainVideo" controls style="display: block" loading="lazy">
            <source src="{{ hostel.video.url }}" type="video/mp4" />
            Your browser does not support the video tag.
          </video>
          <img
            id="mainImage"
            src="{% if hostel.images.first %}{{ hostel.images.first.image.url }}{% endif %}"
            alt="{{ hostel.name }}"
            style="display: none"
            loading="lazy"
          />
          {% else %}
          <!-- Main image only -->
          <img
            id="mainImage"
            src="{% if hostel.images.first %}{{ hostel.images.first.image.url }}{% endif %}"
            alt="{{ hostel.name }}"
            loading="lazy"
          />
          {% endif %}

          <div class="media-counter">
            <span id="currentMediaNumber">1</span> / {% if hostel.video %}
            {{ hostel.images.count|add:1 }}{% else %}{{ hostel.images.count }}{% endif %}
          </div>
        </div>

        {% if hostel.video or hostel.images.count > 1 %}
        <!-- Thumbnails for images and/or video -->
        <div class="thumbnail-container">
          <div class="thumbnail-grid" id="thumbnailGrid">
            {% if hostel.video %}
            <video
              class="thumbnail video-thumbnail active"
              data-index="0"
              data-type="video"
              muted
              loading="lazy"
            >
              <source src="{{ hostel.video.url }}" type="video/mp4" />
            </video>
            {% endif %} {% for image in hostel.images.all %}
            <img
              src="{{ image.image.url }}"
              alt="{{ hostel.name }} image {{ forloop.counter }}"
              class="thumbnail {% if not hostel.video and forloop.first %}active{% endif %}"
              data-index="{% if hostel.video %}{{ forloop.counter }}{% else %}{{ forloop.counter0 }}{% endif %}"
              data-type="image"
              loading="lazy"
            />
            {% endfor %}
          </div>
        </div>
        {% endif %}
      </div>

      <!-- About hostel section -->
      <div class="about-hostel">
        <div class="units-price">
          <p>{{ hostel.available_vacants }} units available</p>
          <p>
            Ksh {{ hostel.pricing|format_price }} / {{ hostel.billing_cycle }}
          </p>
        </div>

        <h2>About this hostel</h2>

        <div class="tab">
          <ul>
            <li class="tab-link active" data-tab="description">Description</li>
            <li class="tab-link" data-tab="amenities">Amenities</li>
            <li class="tab-link" data-tab="category">Category</li>
            <li class="tab-link" data-tab="ratings">Ratings</li>
          </ul>
        </div>

        <!-- Tab contents -->
        <div class="tab-content active" id="description">
          <div class="description">
            {% if hostel.description %}
            <p>{{ hostel.description }}</p>
            {% else %}
            <p style="color: #999; font-style: italic">
              No description available for this hostel.
            </p>
            {% endif %}
          </div>
        </div>

        <div class="tab-content" id="amenities">
          <div class="amenities">
            {% if hostel.amenities.all %}
            <div class="amenities-grid">
              {% for amenity in hostel.amenities.all %}
              <div class="amenity-item">
                <i class="bx bx-check-circle amenity-icon"></i>
                <span>{{ amenity.name }}</span>
                {% if amenity.description %}
                <div class="amenity-tooltip">{{ amenity.description }}</div>
                {% endif %}
              </div>
              {% endfor %}
            </div>
            {% else %}
            <p style="color: #999; font-style: italic">
              No amenities listed for this hostel.
            </p>
            {% endif %}
          </div>
        </div>

        <div class="tab-content" id="category">
          <div class="category">
            {% if hostel.category %}
            <div class="category-info">
              <h4>Room Type</h4>
              <span class="category-badge"
                >{{ hostel.get_category_display }}</span
              >
              <p style="margin-top: 15px; color: #666">
                This hostel offers {{ hostel.get_category_display|lower }}
                accommodations.
              </p>
            </div>
            {% else %}
            <p style="color: #999; font-style: italic">
              Category information not available.
            </p>
            {% endif %}
          </div>
        </div>

        <div class="tab-content" id="ratings">
          <div class="ratings">
            {% if hostel.reviews.all %}
            <!-- Ratings summary -->
            <div class="ratings-summary">
              <div class="average-rating">
                {{ hostel.average_rating|floatformat:1 }}
              </div>
              <div class="rating-stars">
                {% for i in "12345" %} {% if forloop.counter <= hostel.average_rating %}
                <i class="bx bxs-star"></i>
                {% else %}
                <i class="bx bx-star"></i>
                {% endif %} {% endfor %}
              </div>
              <div class="rating-text">
                Based on {{ hostel.reviews.count }} review {{ hostel.reviews.count|pluralize }}
              </div>
            </div>

            <!-- List of individual reviews -->
            <div class="reviews-list">
              {% for review in hostel.reviews.all|dictsortreversed:"created_at" %}
              <div class="review-item">
                <div class="review-header">
                  <div class="review-stars">
                    {% for i in "12345" %} {% if forloop.counter <= review.rating %}
                    <i class="bx bxs-star"></i>
                    {% else %}
                    <i class="bx bx-star"></i>
                    {% endif %} {% endfor %}
                  </div>
                  <div class="review-date">
                    {{ review.created_at|date:"M d, Y" }}
                  </div>
                </div>
                <div class="review-comment">{{ review.comment }}</div>
              </div>
              {% endfor %}
            </div>
            {% else %}
            <div class="no-reviews">
              <p>No reviews yet for this hostel.</p>
              <p>Be the first to share your experience!</p>
            </div>
            {% endif %}
          </div>
        </div>
      </div>
    </div>

    <!-- Right column: Contact & Inquiry -->
    <div class="hostel-contact">
      <h3 style="margin-bottom: 20px">Contact about Hostel</h3>

      <div class="contact-buttons">
          {% with phone_number=hostel.phone|default:"+254703853259" %}
            <a href="tel:{{ phone_number }}" class="phone-link">
              <i class="bx bx-phone"></i> Call
            </a>

            {% if user.is_authenticated %}
              <a
                href="https://wa.me/{{ phone_number }}?text={{ "Hello, I am "|add:user.get_full_name|add:" from Jaramogi Oginga Odinga University. I found this hostel ("|add:hostel.name|add:" at "|add:hostel.location|add:") on JoouStay and I am interested in renting. Here’s the link: "|add:request.build_absolute_uri|urlencode }}"
                target="_blank"
                class="whatsapp-link"
              >
                <i class="bx bxl-whatsapp"></i> WhatsApp
              </a>
            {% else %}
              <a
                href="https://wa.me/{{ phone_number }}?text={{ "Hello, I am a student at Jaramogi Oginga Odinga University. I found this hostel ("|add:hostel.name|add:" at "|add:hostel.location|add:") on JoouStay and I am interested in renting. Here’s the link: "|add:request.build_absolute_uri|urlencode }}"
                target="_blank"
                class="whatsapp-link"
              >
                <i class="bx bxl-whatsapp"></i> WhatsApp
              </a>
            {% endif %}
          {% endwith %}
       </div>

      <div class="contact-card">
        <h3>Send us a message</h3>

        <form id="inquiryForm" method="post">
          {% csrf_token %}

          <div class="form-group">
            <label for="full_name">Full Name</label>
            <input
              type="text"
              id="full_name"
              name="full_name"
              required
              class="form-control"
              placeholder="Your full name"
              value="{{ request.user.get_full_name }}"
            />
          </div>

          <div class="form-group">
            <label for="email">Email</label>
            <input
              type="email"
              id="email"
              name="email"
              required
              class="form-control"
              placeholder="Your email"
              value="{{ request.user.email }}"
            />
          </div>

          <div class="form-group">
            <label for="phone">Phone Number</label>
            <input
              type="text"
              id="phone"
              name="phone"
              class="form-control"
              placeholder="Your phone number"
            />
          </div>

          <div class="form-group">
            <label for="message">Message</label>
            <textarea
              id="message"
              name="message"
              required
              class="form-control"
              placeholder="Your message"
            ></textarea>
          </div>

          <button type="submit" class="btn btn-primary" id="submitBtn">
            Send Message
          </button>
        </form>
      </div>

      <!-- Social share links -->
      <div class="share-links">
        <h4>Share this hostel:</h4>
        <a
          href="https://wa.me/?text={{ request.build_absolute_uri }}"
          target="_blank"
        >
          <i class="bx bxl-whatsapp"></i> WhatsApp
        </a>
        <a
          href="https://www.facebook.com/sharer/sharer.php?u={{ request.build_absolute_uri }}"
          target="_blank"
        >
          <i class="bx bxl-facebook"></i> Facebook
        </a>
        <a
          href="https://twitter.com/intent/tweet?url={{ request.build_absolute_uri }}&text={{ hostel.name }}"
          target="_blank"
        >
          <i class="bx bxl-twitter"></i> Twitter
        </a>
        <a
          href="mailto:?subject=Check out this hostel&body={{ request.build_absolute_uri }}"
        >
          <i class="bx bx-mail-send"></i> Email
        </a>
        <a href="#" id="copyLinkBtn">
          <i class="bx bx-link-alt"></i> Copy Link
        </a>
      </div>
    </div>
  </div>
</div>

<!-- Success overlay for form submission -->
<div class="success-overlay" id="successOverlay">
  <div class="success-message">
    <div class="success-checkmark">✓</div>
    <h3>Success!</h3>
    <p>We have received your message and will get back to you shortly.</p>
  </div>
</div>

<div class="copy-success" id="copySuccess">Link copied to clipboard!</div>

<script src="{% static 'js/core/hostel_detail.js' %}"></script>

{% endblock %}
