{% extends 'users/base.html' %} {% block title %}Your Profile{% endblock %} 
{% load static %} {% block content %}
<link
  href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css"
  rel="stylesheet"
/>
<link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css"
/>

<link rel="stylesheet" href="{% static 'css/users/profile.css' %}" />
<div class="profile-container">
  <div class="profile-main-content">
    <div class="profile-left-column">
      <!-- Main profile card with avatar and basic info -->
      <div class="profile-card">
        <i
          class="bx bx-edit-alt edit-icon"
          onclick="openModal('editNameModal')"
        ></i>
        <div class="profile-background"></div>
        <div class="profile-content">
          <div class="profile-avatar-container">
            {% if user.profile.profile_picture %}
            <img
              class="profile-avatar"
              src="{{ user.profile.profile_picture.url }}"
              alt="{{ user.get_full_name|default:user.username }}"
            />
            {% elif user.profile.google_avatar_url %}
            <img
              class="profile-avatar"
              src="{{ user.profile.google_avatar_url }}"
              alt="{{ user.get_full_name|default:user.username }}"
            />
            {% else %}
            <img
              class="profile-avatar"
              src="{% static 'images/default_images/default_user.png' %}"
              alt="default"
            />
            {% endif %}
            <div
              class="camera-overlay"
              onclick="document.getElementById('file-input').click()"
            >
              <i class="bx bx-camera"></i>
            </div>
          </div>

          <div class="profile-info">
            <h1>{{ user.get_full_name|title|default:user.username }}</h1>
            <p class="profile-username">@{{ user.username }}</p>
            <p class="date-joined">
              Member since {{ user.date_joined|date:"F j, Y" }}
            </p>
          </div>
        </div>
      </div>

      <!-- About/Bio section -->
      <div class="bio-section">
        <i
          class="bx bx-edit-alt edit-icon"
          onclick="openModal('editBioModal')"
        ></i>
        <h2 class="bio-title">About</h2>
        <p class="bio-text">
          {{ user.profile.bio|default:"Welcome to my profile! I'm excited to be part of JoouStay." }}
        </p>
      </div>

      <!-- Personal details section -->
      <div class="personal-section">
        <i
          class="bx bx-edit-alt edit-icon"
          onclick="openModal('editPersonalModal')"
        ></i>
        <h2 class="personal-title">Personal Details</h2>
        <div class="personal-grid">
          <div class="personal-field">
            <span class="field-label">Gender</span>
            <span
              class="field-value {% if not user.profile.gender %}empty{% endif %}"
            >
              {{ user.profile.gender|default:"Not provided" }}
            </span>
          </div>
          <div class="personal-field">
            <span class="field-label">Date of Birth</span>
            <span
              class="field-value {% if not user.profile.date_of_birth %}empty{% endif %}"
            >
              {{ user.profile.date_of_birth|date:"F j, Y"|default:"Not provided" }}
            </span>
          </div>
        </div>
      </div>
    </div>

    <!-- Sidebar with contact and location -->
    <div class="profile-sidebar">
      <!-- Contact information card -->
      <div class="profile-sidebar-card">
        <i
          class="bx bx-edit-alt edit-icon"
          onclick="openModal('editContactModal')"
        ></i>
        <h3 class="profile-sidebar-title">Contact</h3>
        <div class="contact-field">
          <span class="field-label">Email</span>
          <span class="field-value {% if not user.email %}empty{% endif %}">
            {{ user.email|default:"Not provided" }}
          </span>
        </div>
        <div class="contact-field">
          <span class="field-label">Phone</span>
          <span
            class="field-value {% if not user.profile.phone_number %}empty{% endif %}"
          >
            {{ user.profile.phone_number|default:"Not provided" }}
          </span>
        </div>
        <div class="contact-field">
          <span class="field-label">WhatsApp</span>
          <span
            class="field-value {% if not user.profile.whatsapp_number %}empty{% endif %}"
          >
            {{ user.profile.whatsapp_number|default:"Not provided" }}
          </span>
        </div>
      </div>

      <!-- Location information card -->
      <div class="profile-sidebar-card">
        <i
          class="bx bx-edit-alt edit-icon"
          onclick="openModal('editLocationModal')"
        ></i>
        <h3 class="profile-sidebar-title">Location</h3>
        <div class="contact-field">
          <span class="field-label">County</span>
          <span
            class="field-value {% if not user.profile.county %}empty{% endif %}"
          >
            {{ user.profile.county|default:"Not provided" }}
          </span>
        </div>
        <div class="contact-field">
          <span class="field-label">Town</span>
          <span
            class="field-value {% if not user.profile.town %}empty{% endif %}"
          >
            {{ user.profile.town|default:"Not provided" }}
          </span>
        </div>
        <div class="contact-field">
          <span class="field-label">Area of Stay</span>
          <span
            class="field-value {% if not user.profile.area_of_stay %}empty{% endif %}"
          >
            {{ user.profile.area_of_stay|default:"Not provided" }}
          </span>
        </div>
      </div>

      <!-- Password -->
      <div class="profile-sidebar-card">
        <h3 class="profile-sidebar-title">Password</h3>
        {% if has_usable_password %}
        <div class="contact-field">
          <span class="field-label">Update Password</span>
          <span class="field-value">
            <button
              type="button"
              class="password-button"
              onclick="openModal('editPasswordModal')"
            >
              Update
            </button>
          </span>
        </div>
        {% else %}
        <div class="contact-field">
          <span class="field-label">Set Password</span>
          <span class="field-value">
            <button
              type="button"
              class="password-button"
              onclick="openModal('editPasswordModal')"
            >
              Set
            </button>
          </span>
        </div>
        {% endif %}
      </div>
    </div>
  </div>

  <!-- Danger zone for account deletion/deactivation -->
  <div class="danger-section">
    <h2 class="danger-title">Danger Zone</h2>
    <div class="danger-buttons">
      <button class="danger-btn" onclick="openModal('deleteAccountModal')">
        Delete Account
      </button>
      <button class="danger-btn" onclick="openModal('deactivateAccountModal')">
        Deactivate Account
      </button>
    </div>
  </div>
</div>

<form
  id="profilePictureForm"
  action="{% url 'users:edit_profile_picture' %}"
  method="post"
  enctype="multipart/form-data"
  style="display: none"
>
  {% csrf_token %}
  <input
    type="file"
    id="file-input"
    name="profile_picture"
    accept="image/*"
    onchange="submitProfilePicture()"
  />
</form>

<!-- Include all modals -->
{% include 'users/partials/edit/edit-name.html' %} 
{% include 'users/partials/edit/edit-bio.html' %}
{% include 'users/partials/edit/edit-personal-info.html' %} 
{% include 'users/partials/edit/edit-contact-info.html' %} 
{% include 'users/partials/edit/edit-location.html' %} 
{% include 'users/partials/edit/change-passworld.html' %} 
{% include 'users/partials/danger-zone/delete-acc.html' %} 
{% include 'users/partials/danger-zone/deactivate-acc.html' %}

<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script src="{% static 'js/users/profile.js' %}"></script>

{% endblock %}
